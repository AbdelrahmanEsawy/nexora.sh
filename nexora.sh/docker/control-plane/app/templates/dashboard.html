{% extends "base.html" %}
{% block content %}
<div class="card" style="margin-bottom:16px;">
  <div class="row" style="justify-content: space-between;">
    <div>
      <div class="project-title">Create a Project</div>
      <div class="muted" style="font-size:12px;">This will provision the dev environment (Odoo 19 Community). Promote to staging and prod when ready.</div>
    </div>
    <form method="post" action="/projects" style="display:flex; gap:8px; align-items:center; flex-wrap: wrap;">
      <input class="input" type="text" name="display_name" placeholder="Project name (display)" value="{{ prefill_display or '' }}" required>
      <input class="input" type="text" name="slug" placeholder="project-slug" value="{{ prefill_slug or '' }}" pattern="[a-z0-9][a-z0-9-]{1,30}" title="2–31 chars, lowercase letters/numbers, hyphens only" required>
      <button class="btn primary" type="submit">Create</button>
      <div class="muted" style="font-size:12px;">Slug: 2–31 chars, lowercase letters/numbers, hyphens only.</div>
    </form>
  </div>
</div>

<div class="grid">
  {% for project in projects %}
  <div class="card">
    <div class="row" style="justify-content: space-between;">
      <div>
        <div class="project-title">{{ project.display_name or project.slug }}</div>
        <div class="muted" style="font-size:12px;">Slug: {{ project.slug }} · Owner: {{ project.owner.username }}</div>
      </div>
      <div class="row">
        <a class="btn" href="/projects/{{ project.id }}/settings">Settings</a>
        <form method="post" action="/projects/{{ project.id }}/delete">
          <button class="btn ghost danger" type="submit">Delete</button>
        </form>
      </div>
    </div>
    <div class="spacer"></div>
    {% for env_name in ["prod","staging","dev"] %}
      {% set env = (project.envs | selectattr("name","equalto", env_name) | list | first) %}
      <div class="row" style="justify-content: space-between; margin-bottom:6px;">
        <span class="env-pill">{{ env_name }}</span>
        {% if env %}
          <a class="btn" href="/projects/{{ project.id }}/env/{{ env_name }}/open">Open</a>
        {% else %}
          <a class="btn ghost" href="/projects/{{ project.id }}/settings">Create</a>
        {% endif %}
      </div>
      {% if env %}
        <div class="muted" style="font-size:12px;">{{ env.host }}</div>
      {% else %}
        <div class="muted" style="font-size:12px;">Not created yet</div>
      {% endif %}
      <div class="spacer"></div>
    {% endfor %}
  </div>
  {% endfor %}
</div>
{% endblock %}
